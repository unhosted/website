<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<title>remoteStorage spec</title>
	
	<link rel="stylesheet" href="../css/reset.css">
	<link rel="stylesheet" href="../css/donate.css">
	<!-- all our JS is at the bottom of the page, except for Modernizr. -->
	<script src="../js/modernizr-1.7.min.js"></script>
	<script type="text/javascript" src="http://use.typekit.com/iek6tvp.js"></script>
	<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<script type="text/javascript">
	/* <![CDATA[ */
	    (function() {
	        var s = document.createElement('script'), t = document.getElementsByTagName('script')[0];
	        s.type = 'text/javascript';
	        s.async = true;
	        s.src = 'http://api.flattr.com/js/0.6/load.js?mode=auto';
	        t.parentNode.insertBefore(s, t);
	    })();
	/* ]]> */
	</script>
</head>

<body>
	<div id="toplight"></div>

<div class="wrapper"><!-- not needed? up to you: http://camendesign.com/code/developpeurs_sans_frontieres -->

	<header class="minimal">
		<h1><a href="http://unhosted.org">UNHOSTED</a></h1>
	</header>
	
	<article id="webDAV">
		<h2>The remoteStorage spec</h2>
		<a href="https://github.com/unhosted/unhosted.github.com/blob/master/html/spec/change7.html">v1.0.7</a>
		<ul class="index">
			<li><a class="scrollPage" href="#intro">Introduction</a></li>
			<li><a class="scrollPage" href="#finger">WebFinger</a></li>
			<li><a class="scrollPage" href="#oauth">OAuth2-cs</a></li>
			<li><a class="scrollPage" href="#KV">Key-value store</a></li>
			<li><a class="scrollPage" href="#KEYS">Choosing keys</a></li>
			<li><a class="scrollPage" href="#conclusion">Conclusion</a></li>
		</ul>
		
		<h3><a id="intro">Introduction</a></h3>
		<p>A remoteStorage service acts as an always-on data storage
		for its users. It does not host any application source code, nor does it execute
		any processing.
		 To make use of a remoteStorage account, the user visits unhosted web apps 
		that run in a browser, or user-agent. This user-agent discovers the user's
		remoteStorage service through WebFinger. It then redirects the user to an OAuth
		dialogue, to establish authentication. Finally, it uses the GET, PUT and DELETE verbs of WebDAV
		to read and write the data on the remoteStorage account.
		</p>
		<p>This document is meant for implementers of a
		<strong>remoteStorage service</strong>. It descibes how a remoteStorage
		service should behave. <strong>Developers</strong> of unhosted web apps should
		download the <a href="https://github.com/unhosted/unhosted/">SDK</a> instead.
		<strong>End-users</strong> who are interested in understanding the concepts
		behind the unhosted web, are better off reading this <a 
		href="http://blogs.fsfe.org/fellowship-interviews/?p=299">interview</a>. In any case, follow our <a
		href="https://groups.google.com/group/unhosted">mailing list</a> for all the latest updates.  </p> <p> In order
		for your service to comply with the remoteStorage standard, it needs to
		implement <strong>WebFinger, OAuth2-cs, GET/PUT/DELETE, and
		CORS</strong>. All of these technologies should be configured to work together
		in the way that this specification describes using the keywords "MUST", "SHOULD"
		and "SHOULD EITHER .. OR", in the meaning specified by <a
		href="http://tools.ietf.org/html/rfc2119">rcf2119</a>.  </p> <p>Throughout this
		text, we use several variables, which are written in capitals, and with a $-sign
		in front of them. They describe the interaction between a user, this user's
		remoteStorage, and an application. The
		variables are: </p> <ul>
                <li><strong>$USERNAME</strong> - the local part of the
		user's global user identifier, that's to say, the part before the '@' sign.</li>
		<li><strong>$USERDOMAIN</strong> - the server part of the user's global user
		identifier, that's to say, the part after the '@' sign.</li>
		<li><strong>$DAVURL</strong> - the base URL of the key-value store.</li>
		<li><strong>$AUTHURL</strong> - the URL for the OAuth2-cs dialog.</li>
		<li><strong>$TYPE</strong> - either 'public' or 'private'.</li>
		<li><strong>$TYPE-MODIFIERS</strong> - zero or more of 'client-chooses-keys', each preceded by '/'.</li>
		<li><strong>$APP</strong> - the URL of the application</li>
		<li><strong>$DATASCOPE</strong> - the string identifying the resource to which
		the user is granting the application access.</li>
		</ul>
		
		<h3><a id="finger">WebFinger</a></h3>

		<p>The remoteStorage service MUST
		implement <a
		href="http://code.google.com/p/webfinger/wiki/WebFingerProtocol">WebFinger</a>.
                In the WebFinger data for <strong>$USERNAME @ $USERDOMAIN</strong>,
		it should add a link element with
		<strong>rel</strong>-attribute
		'<strong>http://w3.org/ns/remoteStorage</strong>'.
		The link should have a <strong>href</strong> attribute containing a url which we shall call <strong>$DAVURL</strong>,
		an <strong>auth</strong> attribute containing a url which we shall call <strong>$AUTHURL</strong>,
		and a <strong>type</strong> attribute containing the string <strong>$TYPE</strong>, optionally followed by a
		<strong>TYPE-MODIFIERS</strong> string.
		All webfinger resources MUST be served with <a
		href="http://www.w3.org/TR/cors/">CORS</a> headers that allow their retrieval
		from any origin. The link should also have an 'auth' attribute pointing to  </p>

		<h3><a id="oauth">OAuth2-cs</a></h3>
		<p>The remoteStorage implementer MUST make <a
		href="http://tools.ietf.org/html/draft-ietf-oauth-v2-13#section-4.2">OAuth2-cs</a>
		available on <strong>$AUTHURL</strong> announced in the lrdd link's auth attribute (no need for CORS headers
		here, because OAuth does redirection and not AJAX).  </p>

		<h3><a id="KV">Key-value store</a></h3>
		<p>Whenever a user <strong>$USERNAME @ $USERDOMAIN</strong> grants an
		<strong>$APP</strong> access to a <strong>$DATASCOPE</strong>, the remoteStorage
		implementer MUST make a key-value store available on
		<strong>$DAVURL/$DATASCOPE/</strong>, implementing the GET, PUT and DELETE verbs of the WebDAV protocol,
		with CORS
		headers that allow any from whichever <strong>$APP</strong> sends it a valid
		bearer token in the http request headers. If <strong>$TYPE</strong> is 'public', the
		key-value store should allow GET requests (as well as HEAD and OPTIONS) without any
		bearer token in the http request headers. That's to say, the OAuth token gives
		the bearer write-access, but all data is publicly readable.
		If <strong>$TYPE</strong> is 'private', then all verbs except OPTIONS should require
		credentials.
			</p>
		<h3><a id="KEYS">Chosing resource keys</a></h3>
		<p>Unless <strong>TYPE-MODIFIERS</strong> contains 'client-chooses-keys', the key-value
		store can reply to a PUT call with a redirect http code, plus a 'Location:' headers, to indicate under
		which key the new value was stored.
		</p> 
			<p>Non-normative hint: For this, it is necessary to 
		exclude (apart from the HEAD and GET verbs) the OPTIONS verb 
		from the http basic auth restrictions. It is also necessary to set the
		-Allow-Credentials header to true, and to echo the Origin specified in the
		request headers back in the -Allow-Origin header (setting it to '*' works for
		the Webfinger URL, but not here, because of an extra restriction on CORS that
		applies when there are credentials involved).</p>

		<h3><a id="conclusion">Conclusion</a></h3>
		<p> A non-normative example
		implementation of this specification is currently visible by visiting <a
		href="http://unhosted.org/demo/text" target="_blank">unhosted LightWriter</a>, or
		viewing its <a href="http://unhosted.org/remoteStorage.js" target="_blank">javascript</a>,
		and <a href="httpTrace.txt" target="_blank">FIXME</a> is a stripped down
		representation of the http trace it produces. It is up to the application, and
		beyond the scope of this spec, to implement end-to-end encryption on top of
		this, possibly using the Stanford Javascript Crypto Library, possibly in a
		WebWorker process. This text may be changed for clarity - its history is tracked
		<a
		href="https://github.com/unhosted/unhosted.github.com/commits/master/html/spec/change7.html" target="_blank">here</a>.
		However, the standard it describes was frozen on <strong>20 October 2011</strong>.
		The standard will not change for at least 6 months (until at least <strong>20
		April 2011</strong>). Even then, if at any point after that improvements to
		this standard are deemed desirable, every attempt will be made to make those
		changes non-breaking.
		  </p>
	</article>
	
</div> <!-- END Wrapper -->
	
	<footer class="footer">
		<div class="wrapper">
			<div class="links">
				<h3>Community</h3>
				<ul>
					<li><a href="http://groups.google.com/group/unhosted" target="_blank">Mailing list</a></li>
					<li><a href="http://github.com/unhosted/unhosted/" target="_blank">Github</a></li>
					<li><a href="https://github.com/unhosted/unhosted/wiki/" target="_blank">Wiki</a></li>
					<li><a href="http://webchat.freenode.net/?channels=unhosted" target="_blank">IRC</a></li>	
					
				</ul>
				
				<div class="clear"></div>
			</div>
			
			<div class="links">
				<h3>Articles</h3>
				<ul>
					<li><a href="http://blogs.fsfe.org/fellowship-interviews/?p=299" target="_blank">FSFE interview</a></li>
					<li><a href="http://www.readwriteweb.com/cloud/2010/12/unhosted.php" target="_blank">Read Write Web</a></li>
					<li><a href="http://www.h-online.com/open/features/Lessons-from-WikiLeaks-decentralize-decentralize-decentralize-1153977.html" target="_blank">The H online</a></li>
					<li><a href="http://lwn.net/Articles/423902/" target="_blank">Linux Weekly</a></li>
				</ul>
				<div class="clear"></div>
			</div>
			
			<div class="links">
				<h3>Social</h3>
				<ul>
					<li><a href="http://identi.ca/unhosted" target="_blank">Identi.ca</a></li>
					<li><a href="http://www.twitter.com/#!/unhosted" target="_blank">Twitter</a></li>
				</ul>
				<div class="clear"></div>
			</div>
			
			<div id="community">
				<p><strong>Unhosted is a project from and for the community...</strong> We believe that we can achieve a better web together, and you are part of it.
				</p>
				
				<p><strong>Be sure to check this site and join our mailing list</strong> for the latest on Unhosted development, documentation and other news regarding the project. We want to hear your ideas!
				</p>
				<div>You make Unhosted!</div>
				<a class="FlattrButton" style="display:none;" href="http://www.unhosted.org/"></a>
				<noscript><a href="http://flattr.com/thing/181201/The-Unhosted-Project" target="_blank">
				<img src="http://api.flattr.com/button/flattr-badge-large.png" alt="Flattr this" title="Flattr this" border="0" /></a></noscript>
			</div>
			<div class="clear"></div>
		</div>	
		<div id="credits">
			<div class="wrapper">
				<span>Sdk licensed under <a href="http://www.gnu.org/licenses/agpl.html" target="_blank">AGPL</a>. Website by <a href="http://www.edokoa.com" target="_blank">edokoa</a>, licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons BY-SA</a></span>
			</div>
		</div>
	</footer>
	
<!-- Grab Google CDN's jQuery. fall back to local if necessary -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<script>window.jQuery || document.write("<script src='../js/jquery-1.5.1.min.js'>\x3C/script>")</script>

<!-- this is where we put our custom functions -->
<script src="../js/functions.js"></script>



</body>
</html>
